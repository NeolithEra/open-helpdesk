{% overextends "admin/helpdesk/change_form.html" %}

{% load helpdesk_tags i18n staticfiles %}

{% block extrahead %}
    {{ block.super }}
    <script src="{% static "helpdesk/js/ticket.js" %}" type="text/javascript"></script>
{% endblock %}

{% block after_field_sets %}
    {% if object_id %}

        <div id="ticket_infos">
            <ul>
                <li><a href="#tab_messages">Messaging</a></li>
                <li><a href="#tab_changestatuslog">Change Status Log</a></li>
            </ul>
            <div id="tab_messages">
                {% if ticket_messages %}
                <fieldset class="module aligned">
                    {% for ticket_message in ticket_messages %}
                        {% format_ticket_message ticket_message %}
                    {% endfor %}
                </fieldset>
                {% endif %}
            </div>
            <div id="tab_changestatuslog">
                {% if ticket_changelogs %}
                    <fieldset class="module aligned">
                        {% for changelog in ticket_changelogs %}
                            <div id="ticket_statuschangelog_{{ changelog.pk }}" class="form-row">
                                {% awesome_status_icon changelog.after %}&nbsp;&nbsp;<b>{% if changelog.before %}{{ changelog.before|capfirst }}&nbsp;&nbsp;{% awesome_icon 'long-arrow-right' %}&nbsp;&nbsp;{% endif %}{{ changelog.after|capfirst }}</b>&nbsp;&nbsp;{{ changelog.created }}
                            </div>
                        {% endfor %}
                </fieldset>
                {% endif %}
            </div>
        </div>

    {% endif %}
{% endblock %}

{% block content %}
    {{ block.super }}
    <script type="text/javascript">
        {% if original.is_closed %}
            $(document).ready(function () {
                var submit_row = $('div.submit-row');
                if (submit_row.length == 0) {
                    alert("ERRORE CONTATTARE L'AMMINISTRATORE DI SISTEMA")
                }
                submit_row.remove();
            });
        {% endif %}
    </script>
{% endblock %}